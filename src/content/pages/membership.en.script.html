<script>
document.getElementById('membership-form-en').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;

      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const profession = (form.profession.value || '').trim();
      const hp = (form.hp?.value || '').trim();

      if (!name || !email) {
        alert('Please fill in both name and email.');
        return;
      }

      const btn = form.querySelector('button[type="submit"]');
      btn.disabled = true; btn.textContent = 'Sendingâ€¦';

      try {
        const resp = await fetch('/api/send-email', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify({
            kind: 'membership',
            name,
            email,
            profession,
            reply_to: email,
            from_name: 'MAI Website',
            from_email: 'info@aimuseum.se',
            hp,
          }),
        });

        if (!resp.ok) {
          const data = await resp.json().catch(() => ({}));
          throw new Error(data?.error || 'Failed to send');
        }

        alert('Thank you! Your membership application has been sent.');
        form.reset();
      } catch (err) {
        console.error('Send error:', err);
        alert('Sorry, there was a problem sending your application.');
      } finally {
        btn.disabled = false; btn.textContent = 'Submit application';
      }
    });
  </script>
